<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="11101001">
    
    <meta name="description" content="&lt;script type=&quot;text/javascript&quot; src=&quot;https://api.lwl12.com/hitokoto/main/get?encode=js&amp;charset=utf-8&quot;&gt;&lt;/script&gt;&lt;div id=&quot;lwlhitokoto&quot;&gt;&lt;script&gt;lwlhitokoto()&lt;/script&gt;&lt;/div&gt;">
    
    
    
    
    
    
    <title>ZZxのwarm blog</title>
    <!-- inject:style -->
    <link href="/css/style.css" rel="stylesheet" type="text/css">
    <!-- endinject -->
    <style>
        .cube-loading {
            top: 0;
            position: fixed;
            width: 100%;
            height: 100%;
            background: url('/images/lg/loading.gif') no-repeat center center;
            background-color: rgba(0,0,0,.7);
        }

        .cube-loading.out {
            display: none;
        }

        .cube-loading:before {
            display: block;
            content: 'Loading';
            position: relative;
            width: 100%;
            top: 50%;
            right: -50%;
            color: #fff;
        }

        @media(max-width: 768px) {
            .cube-loading:before {
                font-size: 1.2em;
                transform: translate(-24px,20px);
                -webkit-transform: translate(-24px,20px);
                -o-transform: translate(-24px,20px);
                -ms-transform: translate(-24px,20px);
            }
        }

        @media(min-width: 768px) {
            .cube-loading:before {

            }
        }
    </style>
    
</head>
<body>
<div class="cube-body">
    <nav id="cube-top-memu" class="cube-menu">
    <ul class="cube-menu-collapse">
        
        <li>
            <i class="cube-icon cube-icon-home" aria-hidden="true"></i>
            <a href="/">首页</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-archive" aria-hidden="true"></i>
            <a href="/archives">归档</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-categories" aria-hidden="true"></i>
            <a href="/categories">分类</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-tags" aria-hidden="true"></i>
            <a href="/tags">标签</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-about" aria-hidden="true"></i>
            <a href="/about-me">关于我</a>
        </li>
        
    </ul>
</nav>
<nav class="cube-side-menu" id="cube-side-menu">
    <ul class="cube-menu-list">
        
        <li>
            <a class="lrc-control">Open Lyrics</a>
        </li>
        
        <li>
            <a class="scroll-to-top">Top</a>
        </li>
    </ul>
</nav>
    <header class="cube-header" id="cube-header">
    <img src=" http://cube-1252774894.cosgz.myqcloud.com/background.png " alt="头部背景图片">
    
    <div class="cube-type">
        <span class="cube-typed-title">senrenbankaの部落格</span>
        <span class="cube-typed-cursor">|</span>
    </div>
    
</header>

    <style>
        nav.cube-menu:before {
            content: '';
            visibility: hidden;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 44px;
        
            filter: blur(5px);
            -webkit-filter: blur(5px);
        
            z-index: -1;
            background-image: url('http://cube-1252774894.cosgz.myqcloud.com/background.png');
            background-repeat: no-repeat;
            background-position: center -356px;
            background-size: cover;
            background-color: transparent;
        }

        header.cube-background.cube-header-background {
            visibility: hidden;
            background-image: url('http://cube-1252774894.cosgz.myqcloud.com/background.png');
            background-position: center -400px;
        }
    </style>
    <header class="cube-background cube-header-background">
        
        <div class="cube-type">
            <span class="cube-typed-title">senrenbankaの部落格</span>
            <span class="cube-typed-cursor">|</span>
        </div>
        
    </header>
    <div class="load-header-background"></div>
    <script>
        (function (window) {

            window.headerModule = {}
            window.headerModule.image = {
                width: '2000',
                height: '1414'
            }

        })(window)
    </script>
    
    <div class="cube-content">
        <div class="cube-left">
            
<div class="cube-excerpt" id="cube-excerpt-&lt;置顶&gt; 罪恶的伊始">
    <header class="cube-excerpt-header">
        <h1><a href="/2018/03/10/总得有个说明吧QAQ/">&lt;置顶&gt; 罪恶的伊始</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2018-03-10
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/说明/" class="cube-excerpt-tag-link">#说明</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <p><img src="https://i.loli.net/2018/04/02/5ac173c5aca64.png" alt="大概是常规的自我介绍"><br>
        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2018/03/10/总得有个说明吧QAQ/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-四月是你の省选 - sdoi2018酱油鸡">
    <header class="cube-excerpt-header">
        <h1><a href="/2018/04/06/sdoi2018游记/">四月是你の省选 - sdoi2018酱油鸡</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2018-04-06
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/说明/" class="cube-excerpt-tag-link">#说明</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <p>游啊游啊游啊游<br>
        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2018/04/06/sdoi2018游记/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-bzoj 4816 [Sdoi2017]数字表格.md">
    <header class="cube-excerpt-header">
        <h1><a href="/2018/04/01/bzoj4816 [Sdoi2017]数字表格/">bzoj 4816 [Sdoi2017]数字表格.md</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2018-04-01
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/数学/" class="cube-excerpt-tag-link">#数学</a>
                
                <a href="/tags/莫比乌斯反演/" class="cube-excerpt-tag-link">#莫比乌斯反演</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h3 id="题目链接"><a href="#题目链接" class="headerlink" title="题目链接"></a>题目链接</h3><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=4816" target="_blank" rel="external">bzoj4816: [Sdoi2017]数字表格</a></p>
<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>满满的反演的套路的味道</p>
<script type="math/tex; mode=display">Ans= \prod_{i=1}^{n} \prod_{j=1}^{m} f[gcd(i,j)]</script><p>常规操作枚举约数</p>
<script type="math/tex; mode=display">\prod_{d=1}^n\prod_{i=1}^n\prod_{j=1}^m gcd(i,j)==d\ ?\ f[gcd(i,j)]</script><p>上面的式子可以化为</p>
<script type="math/tex; mode=display">\prod_{d=1}^{n}f[d]^{\sum_{i=1}^{n}\sum_{j=1}^{m}[gcd(i,j)==d]}</script><p>对于右上角的式子</p>
<script type="math/tex; mode=display">\sum_{i=1}^{n}\sum_{j=1}^{m}[gcd(i,j)==d]</script><p>很眼熟…推下式子</p>
<script type="math/tex; mode=display">=\sum_{i=1}^{? \dfrac{n}{d}?}\sum_{j=1}^{?\dfrac{m}{d}?}[gcd(i,j)==1]</script><script type="math/tex; mode=display">=\sum_{i=1}^{min(\dfrac{n}{d},\dfrac{m}{d})} \mu(i)\sum_{i|p,p\leq n/d }\sum_{i|j,j\leq m/d}1</script><script type="math/tex; mode=display">=\sum_{i=1}^{n/d}\mu(i)\left \lfloor \frac{n}{id}\right \rfloor \left \lfloor\frac{m}{id} \right \rfloor</script><p>令$p=id$那么原式变成了</p>
<script type="math/tex; mode=display">\prod_{p=1}^{min(n,m)} \prod_{d|p} f[d]^{\left \lfloor \frac{n}{p} \right \rfloor \left \lfloor \frac{m}{p} \right \rfloor \mu(\frac{p}{d})} = \prod_{p=1}^{min(n,m)} (\prod_{d|p} f[d]^{\mu(\frac{p}{d})})^{\left \lfloor \frac{n}{p} \right \rfloor \left \lfloor \frac{m}{p} \right \rfloor}</script><p>对于每个$p$,令$F[p]=\prod_{d|p} f[d]^{\mu(\frac{p}{d})}$,$F[p]$的值是固定的，用筛法求出$F[p]$，做前缀积，对与$\left \lfloor \frac{n}{p} \right \rfloor \left \lfloor \frac{m}{p} \right \rfloor$数论分块一下<br>复杂度为$O((n+T\sqrt{n})log(1e9+7))$</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1000007</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">1e9</span>+<span class="number">7</span>;</div><div class="line"><span class="keyword">int</span> f[maxn+<span class="number">7</span>],invf[maxn+<span class="number">7</span>],F[maxn+<span class="number">7</span>];</div><div class="line"><span class="keyword">bool</span> isprime[maxn+<span class="number">7</span>];<span class="keyword">int</span> mu[maxn+<span class="number">7</span>],prime[maxn+<span class="number">7</span>],num;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">pow</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> p)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ret=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(;p;p&gt;&gt;=<span class="number">1</span>,a=(<span class="number">1L</span>L*a*a)%mod)&#123;</div><div class="line">        <span class="keyword">if</span>(p&amp;<span class="number">1</span>) ret=(<span class="number">1L</span>L*ret*a)%mod;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    f[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;maxn;++i) f[i]=(f[i<span class="number">-1</span>]+f[i<span class="number">-2</span>])%mod;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;maxn;++i) &#123;</div><div class="line">        invf[i]=<span class="built_in">pow</span>(f[i],mod<span class="number">-2</span>)%mod;</div><div class="line">        <span class="comment">//printf("%d %d\n",invf[i],f[i]);</span></div><div class="line">    &#125;</div><div class="line">    isprime[<span class="number">1</span>]=<span class="number">1</span>;mu[<span class="number">1</span>]=<span class="number">1</span>;F[<span class="number">0</span>]=F[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">    <span class="comment">//printf("%d\n",mu[1]);</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=maxn<span class="number">-7</span>;++i) &#123;</div><div class="line">        F[i]=<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(!isprime[i]) prime[++num]=i,mu[i]=<span class="number">-1</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=num&amp;&amp;prime[j]*i&lt;=maxn<span class="number">-7</span>;++j) &#123;</div><div class="line">            isprime[i*prime[j]]=<span class="number">1</span>;</div><div class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>) &#123;mu[i*prime[j]]=<span class="number">0</span>;<span class="keyword">break</span>;&#125;</div><div class="line">            <span class="keyword">else</span> mu[i*prime[j]]=-mu[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=maxn<span class="number">-7</span>;++i) &#123;</div><div class="line">        <span class="keyword">if</span>(mu[i]==<span class="number">0</span>)<span class="keyword">continue</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i;j&lt;=maxn<span class="number">-7</span>;j+=i) &#123;</div><div class="line">            <span class="keyword">if</span>(mu[i]==<span class="number">1</span>) F[j]=(<span class="number">1l</span>l*F[j]*f[j/i])%mod;</div><div class="line">            <span class="keyword">if</span>(mu[i]==<span class="number">-1</span>) F[j]=(<span class="number">1l</span>l*F[j]*invf[j/i])%mod;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=maxn<span class="number">-7</span>;++i) F[i]=(<span class="number">1l</span>l*F[i]*F[i<span class="number">-1</span>])%mod;<span class="comment">//,printf("%d\n",F[i]);</span></div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n=<span class="built_in">std</span>::min(a,b);<span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> nxt,i=<span class="number">1</span>;i&lt;=n;i=nxt+<span class="number">1</span>) &#123;</div><div class="line">        nxt=<span class="built_in">std</span>::min(a/(a/i),b/(b/i));</div><div class="line">        <span class="keyword">long</span> <span class="keyword">long</span> tmp=<span class="number">1l</span>l*F[nxt]*<span class="built_in">pow</span>(F[i<span class="number">-1</span>],mod<span class="number">-2</span>)%mod;</div><div class="line">        ans=(<span class="number">1l</span>l*ans*<span class="built_in">pow</span>(tmp,<span class="number">1l</span>l*(a/i)*(b/i)%(mod<span class="number">-1</span>)))%mod;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> (ans+mod)%mod;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">//freopen("001.out","w",stdout);</span></div><div class="line">    init();	</div><div class="line">    <span class="keyword">int</span> T;<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;T);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> a,b;T--;) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;a,&amp;b);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(a,b));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2018/04/01/bzoj4816 [Sdoi2017]数字表格/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-bzoj 4817 [Sdoi2017]树点涂色">
    <header class="cube-excerpt-header">
        <h1><a href="/2018/04/01/bzoj4817[Sdoi2017]树点涂色/">bzoj 4817 [Sdoi2017]树点涂色</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2018-04-01
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/数据结构/" class="cube-excerpt-tag-link">#数据结构</a>
                
                <a href="/tags/Link-cut-tree/" class="cube-excerpt-tag-link">#Link cut tree</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h3 id="题目链接"><a href="#题目链接" class="headerlink" title="题目链接"></a>题目链接</h3><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=4817" target="_blank" rel="external">bzoj4817: [Sdoi2017]树点涂色</a></p>
<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>数据结构…..大概很容易看出是道lct <del>然后弃疗</del><br>操作1很想lct里面的access操作<br>那么对于操作2<br>设F[i]=i点到lct根路径上的splay数（也就是虚边数）+1<br>那么对于操作2的(x,y)<br>ans(x,y)=F[x]+F[y]-(F(lca(x,y)))+1;<br>对于操作3的(x),就是在x的子树中取max，我们可以用dfs序+线段树维护<br>考虑操作1对操作3的影响<br>在access的时候，当一个边由虚变实，此时该边所连的深度大的点的颜色种类-1<br>反之当一边由实变虚，此时该边所连的深度大的点的颜色种类+1<br>trick:保存当前节点在树中最左儿子的编号用以修改区间(即left[])<br>ps:中途电脑爆炸,然后重码QAQ，心态爆炸</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> *</div><div class="line"> * 数据结构+LCT+SEG_TREE</div><div class="line"> *  </div><div class="line"> */</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100007</span>;</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="keyword">struct</span> node&#123;</div><div class="line">    <span class="keyword">int</span> v,next;</div><div class="line">&#125;edge[maxn&lt;&lt;<span class="number">1</span>];</div><div class="line"><span class="keyword">int</span> head[maxn],num;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add_Edge</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    edge[++num].v=v;edge[num].next=head[u];head[u]=num;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> idfn[maxn],ldfn[maxn],rdfn[maxn],f[maxn][<span class="number">20</span>],dep[maxn];</div><div class="line"><span class="keyword">int</span> cnt=<span class="number">0</span>,fa[maxn];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> F)</span> </span>&#123;</div><div class="line">    idfn[ldfn[u]=++cnt]=u,f[u][<span class="number">0</span>]=fa[u]=F;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=head[u];i;i=edge[i].next) &#123;</div><div class="line">        <span class="keyword">int</span> v=edge[i].v;</div><div class="line">        <span class="keyword">if</span>(v!=F) dep[v]=dep[u]+<span class="number">1</span>,dfs(v,u);</div><div class="line">    &#125;</div><div class="line">    rdfn[u]=cnt;</div><div class="line">    <span class="keyword">return</span> ;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(dep[x]&lt;dep[y]) <span class="built_in">std</span>::swap(x,y);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=dep[x]-dep[y],j=<span class="number">0</span>;i;i&gt;&gt;=<span class="number">1</span>,++j)</div><div class="line">        <span class="keyword">if</span>(i&amp;<span class="number">1</span>)x=f[x][j];</div><div class="line">    <span class="keyword">if</span>(x==y) <span class="keyword">return</span> x;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">19</span>;~i;--i) </div><div class="line">        <span class="keyword">if</span>(f[x][i]!=f[y][i]) </div><div class="line">            x=f[x][i],y=f[y][i];</div><div class="line">    <span class="keyword">return</span> f[x][<span class="number">0</span>];</div><div class="line">&#125;</div><div class="line"><span class="keyword">class</span> Segment_Tree &#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> lc x&lt;&lt;1</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rc x&lt;&lt;1|1</span></div><div class="line">    <span class="keyword">private</span> :</div><div class="line">        </div><div class="line">        <span class="keyword">struct</span> Node &#123;</div><div class="line">            <span class="keyword">int</span> max,tag;</div><div class="line">            Node () : tag(<span class="number">0</span>)&#123;&#125;</div><div class="line">        &#125;;</div><div class="line">        Node t[maxn&lt;&lt;<span class="number">2</span>];</div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">            t[x].max=<span class="built_in">std</span>::max(t[lc].max,t[rc].max);</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">push_down</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span>(!t[x].tag)<span class="keyword">return</span>;</div><div class="line">            <span class="keyword">int</span> k=t[x].tag;</div><div class="line">            t[lc].max+=k;</div><div class="line">            t[lc].tag+=k;</div><div class="line">            t[rc].max+=k;</div><div class="line">            t[rc].tag+=k;</div><div class="line">            t[x].tag=<span class="number">0</span>;</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    <span class="keyword">public</span> :</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">build</span> <span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span>(l==r) &#123;</div><div class="line">                t[x].max=dep[idfn[l]]+<span class="number">1</span>;<span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</div><div class="line">            build(lc,l,mid);</div><div class="line">            build(rc,mid+<span class="number">1</span>,r);</div><div class="line">            <span class="keyword">return</span> update(x);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> L,<span class="keyword">int</span>  R,<span class="keyword">int</span> w)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span>(L&lt;=l&amp;&amp;R&gt;=r) &#123;</div><div class="line">                t[x].tag+=w;t[x].max+=w;</div><div class="line">                <span class="keyword">return</span> ;</div><div class="line">            &#125;</div><div class="line">            push_down(x);</div><div class="line">            <span class="keyword">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</div><div class="line">            <span class="keyword">if</span>(mid&gt;=L) modify(lc,l,mid,L,R,w);</div><div class="line">            <span class="keyword">if</span>(mid&lt;R) modify(rc,mid+<span class="number">1</span>,r,L,R,w);</div><div class="line">            <span class="keyword">return</span> update(x);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> L,<span class="keyword">int</span>  R)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span>(L&lt;=l&amp;&amp;R&gt;=r) </div><div class="line">                <span class="keyword">return</span> t[x].max;</div><div class="line">            push_down(x);</div><div class="line">            <span class="keyword">int</span> mid=l+r&gt;&gt;<span class="number">1</span>,ans=<span class="number">0</span>;</div><div class="line">            <span class="keyword">if</span>(mid&gt;=L) ans=<span class="built_in">std</span>::max(ans,query(lc,l,mid,L,R));</div><div class="line">            <span class="keyword">if</span>(mid&lt;R) ans=<span class="built_in">std</span>::max(ans,query(rc,mid+<span class="number">1</span>,r,L,R));</div><div class="line">            <span class="keyword">return</span> ans;</div><div class="line">        &#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">undef</span> lc</span></div><div class="line"><span class="meta">#<span class="meta-keyword">undef</span> rc</span></div><div class="line">&#125;SEG_T;</div><div class="line"><span class="keyword">class</span> Link_Cut_tree &#123;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> lc ch[x][0]</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> rc ch[x][1]</span></div><div class="line">    <span class="keyword">private</span> : </div><div class="line">        </div><div class="line">        <span class="keyword">int</span> ch[maxn][<span class="number">2</span>],left[maxn];</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        left[x]=lc ? left[lc]:x;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isroot</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> ch[fa[x]][<span class="number">0</span>]!=x&amp;&amp;ch[fa[x]][<span class="number">1</span>]!=x;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> y=fa[x],z=fa[y],d=(ch[y][<span class="number">1</span>]==x)^<span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span>(!isroot(y)) ch[z][ch[z][<span class="number">1</span>]==y]=x;fa[x]=z;</div><div class="line">        ch[y][d^<span class="number">1</span>]=ch[x][d],fa[ch[x][d]]=y;</div><div class="line">        ch[x][d]=y;fa[y]=x;</div><div class="line">        update(y),update(x);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span>(!isroot(x)) &#123;</div><div class="line">            <span class="keyword">int</span> y=fa[x],z=fa[y];</div><div class="line">            <span class="keyword">if</span>(!isroot(y)) &#123;</div><div class="line">                <span class="keyword">if</span>(ch[y][<span class="number">1</span>]==x^ch[z][<span class="number">1</span>]==y) rotate(x);</div><div class="line">                <span class="keyword">else</span> rotate(y);</div><div class="line">            &#125;</div><div class="line">            rotate(x);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">            dfs(<span class="number">1</span>,<span class="number">0</span>),SEG_T.build(<span class="number">1</span>,<span class="number">1</span>,n);</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) left[i]=i;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;<span class="number">20</span>;j++)</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">                    f[i][j]=f[f[i][j<span class="number">-1</span>]][j<span class="number">-1</span>];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">access</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> t=<span class="number">0</span>;x;x=fa[t=x]) &#123;</div><div class="line">                splay(x);</div><div class="line">                <span class="keyword">if</span>(rc) SEG_T.modify(<span class="number">1</span>,<span class="number">1</span>,n,ldfn[left[rc]],rdfn[left[rc]],<span class="number">1</span>);</div><div class="line">                rc=t;</div><div class="line">                <span class="keyword">if</span>(rc) SEG_T.modify(<span class="number">1</span>,<span class="number">1</span>,n,ldfn[left[rc]],rdfn[left[rc]],<span class="number">-1</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> ;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">            <span class="keyword">int</span> ans=<span class="number">0</span>;</div><div class="line">            <span class="keyword">for</span>(;x;x=fa[x],ans++)splay(x);</div><div class="line">            <span class="keyword">return</span> ans;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> query(u)+query(v)<span class="number">-2</span>*query(LCA(u,v))+<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">undef</span> lc</span></div><div class="line"><span class="meta">#<span class="meta-keyword">undef</span> rc</span></div><div class="line"></div><div class="line">&#125;LCT;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">//	freopen("001.out","w",stdout);</span></div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m) ;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> a,b,i=<span class="number">1</span>;i&lt;n;++i) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;a,&amp;b);</div><div class="line">        Add_Edge(a,b);</div><div class="line">        Add_Edge(b,a);</div><div class="line">    &#125;</div><div class="line">    LCT.init();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> opt,x,y,i=<span class="number">1</span>;i&lt;=m;++i) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;opt);</div><div class="line">        <span class="keyword">if</span>(opt==<span class="number">1</span>) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x),LCT.access(x);</div><div class="line">        <span class="keyword">if</span>(opt==<span class="number">2</span>) <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y),<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,LCT.query(x,y));</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">3</span>) <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x),<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,SEG_T.query(<span class="number">1</span>,<span class="number">1</span>,n,ldfn[x],rdfn[x]));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2018/04/01/bzoj4817[Sdoi2017]树点涂色/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-bzoj 3994 [SDOI2015]约数个数和">
    <header class="cube-excerpt-header">
        <h1><a href="/2018/03/11/bzoj3994[SDOI2015]约数个数和/">bzoj 3994 [SDOI2015]约数个数和</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2018-03-11
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/数学/" class="cube-excerpt-tag-link">#数学</a>
                
                <a href="/tags/莫比乌斯反演/" class="cube-excerpt-tag-link">#莫比乌斯反演</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h2 id="题目链接"><a href="#题目链接" class="headerlink" title="题目链接"></a>题目链接</h2><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=3994" target="_blank" rel="external">bzoj 3994: [SDOI2015]约数个数和</a></p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>结论与结论的证明参考了rqy的博客<br>计算$d(ij)$时，把ij的每个约数d映射到$(a=gcd(d,i),b=(gcd(d,i),\frac{d}{gcd(d, i)})$<br>可知$a,b$分别是$i,j$的因数，且$(a,b)$对应一个因数当且仅当$gcd(\frac ia, b) = 1$，所以</p>
<script type="math/tex; mode=display">d(ij) = \sum_{x|i}\sum_{y|j} [gcd(\frac ix, y) = 1] = \sum_{x'|i}\sum_{y|j} [gcd(x', y) = 1]</script><p>有了这个式子之后</p>
<script type="math/tex; mode=display">\sum_{i=1}^n\sum_{j=1}^m d(ij)</script><script type="math/tex; mode=display">=\sum_{i=1}^n\sum_{j=1}^m\sum_{x|i}\sum_{y|j} [gcd(x, y) = 1]</script><script type="math/tex; mode=display">=\sum_{i=1}^n\sum_{j=1}^m \left\lfloor\frac ni\right\rfloor \left\lfloor\frac mj\right\rfloor [gcd(i, j) = 1]</script><script type="math/tex; mode=display">=\sum_{i=1}^{n}\sum_{j=1}^{m}\sum_{d|i}\sum_{d|j}\mu(d)\lfloor\frac{n}{i}\rfloor\lfloor\frac{m}{j}\rfloor</script><script type="math/tex; mode=display">=\sum_{d=1}^{min(n,m)}\sum_{i=1}^{\lfloor\frac{n}{d}\rfloor}\sum_{j=1}^{\lfloor\frac{m}{d}\rfloor}\mu(d)\lfloor\frac{n}{i}\rfloor\lfloor\frac{m}{j}\rfloor</script><script type="math/tex; mode=display">=\sum_{d=1}^{min(n,m)}\mu(d)\sum_{i=1}^{\lfloor\frac{n}{d}\rfloor}\lfloor\frac{n}{i}\rfloor\sum_{j=1}^{\lfloor\frac{m}{d}\rfloor}\lfloor\frac{m}{j}\rfloor</script><p>用$f(x)=\sum_{i=1}^{x}\lfloor\frac{x}{i}\rfloor$表示1-x的约数个数和</p>
<p><script type="math/tex">\sum_{d=1}^{min(n,m)}\mu(d)f(\lfloor\frac{n}{d}\rfloor)f(\lfloor\frac{m}{d}\rfloor)</script>预处理$\mu(n)$前缀和<br>对于$f$我们可以$O(n\sqrt n)$预处理,查询为$O(\sqrt n)$</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">50007</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">    <span class="keyword">char</span> c=getchar();</div><div class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>)&#123;<span class="keyword">if</span>(c==<span class="string">'0'</span>)f=<span class="number">-1</span>;c=getchar();&#125;</div><div class="line">    <span class="keyword">while</span>(c&lt;=<span class="string">'9'</span>&amp;&amp;c&gt;=<span class="string">'0'</span>)x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">    <span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> f[maxn],mu[maxn],num,prime[maxn];</div><div class="line"><span class="keyword">bool</span> vis[maxn];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">countf</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,last;i&lt;=x;i=last+<span class="number">1</span>) &#123;</div><div class="line">        last=x/(x/i);</div><div class="line">        ans+=x/i*(last-i+<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_mu</span><span class="params">()</span> </span>&#123;</div><div class="line">    mu[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;maxn;++i) &#123;</div><div class="line">        <span class="keyword">if</span>(!vis[i])prime[++num]=i,mu[i]=<span class="number">-1</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=num&amp;&amp;i*prime[j]&lt;maxn;++j) &#123;</div><div class="line">            vis[prime[j]*i]=<span class="number">1</span>;</div><div class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>)mu[prime[j]*i]=<span class="number">0</span>;</div><div class="line">            <span class="keyword">else</span> mu[i*prime[j]]=-mu[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;maxn;++i)mu[i]+=mu[i<span class="number">-1</span>];</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;maxn;++i)f[i]=countf(i);</div><div class="line">    get_mu();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> m)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>,last;i&lt;=<span class="built_in">std</span>::min(n,m);i=last+<span class="number">1</span>) &#123;</div><div class="line">        last=<span class="built_in">std</span>::min(n/(n/i),m/(m/i));</div><div class="line">        ans+=(mu[last]-mu[i<span class="number">-1</span>])*f[n/i]*f[m/i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line">main() &#123;</div><div class="line">    init();</div><div class="line">    <span class="keyword">int</span> T=read();</div><div class="line">    <span class="keyword">for</span>(;T--;) &#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,solve(read(),read()));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> tmp=<span class="number">0</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2018/03/11/bzoj3994[SDOI2015]约数个数和/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-数列分块1-9">
    <header class="cube-excerpt-header">
        <h1><a href="/2018/03/10/数列分块1-9/">数列分块1-9</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2018-03-10
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/题解/" class="cube-excerpt-tag-link">#题解</a>
                
                <a href="/tags/分块/" class="cube-excerpt-tag-link">#分块</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h1 id="数列分块1-9"><a href="#数列分块1-9" class="headerlink" title="数列分块1-9"></a>数列分块1-9</h1><p>偷下懒QuQ</p>
<h2 id="题目链接"><a href="#题目链接" class="headerlink" title="题目链接"></a>题目链接</h2><p><a href="https://loj.ac/problems/search?keyword=%E6%95%B0%E5%88%97%E5%88%86%E5%9D%97%E5%85%A5%E9%97%A8" target="_blank" rel="external">loj的数列分块如门1-9</a></p>
<h2 id="这算是题解了吧"><a href="#这算是题解了吧" class="headerlink" title="这算是题解了吧"></a>这算是题解了吧</h2><p>题解的话<br>我就不说了吧<br>毕竟，黄学长的博客里已经说得<br>很清楚了<br>吧2333(我真是废QAQ<br>………<a href="http://hzwer.com/8053.html" target="_blank" rel="external">Hzwer传送门</a></p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="数列分块1"><a href="#数列分块1" class="headerlink" title="数列分块1"></a>数列分块1</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;	</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">	<span class="keyword">char</span> c=getchar();</div><div class="line">	<span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>) &#123;<span class="keyword">if</span>(c==<span class="string">'0'</span>)f=<span class="number">-1</span>;c=getchar();&#125;</div><div class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">'9'</span>&amp;&amp;c&gt;=<span class="string">'0'</span>)x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">	<span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100007</span>;</div><div class="line"><span class="keyword">int</span> a[maxn],bl[maxn],tag[maxn],size;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> aa,<span class="keyword">int</span> b,<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=aa;i&lt;=<span class="built_in">std</span>::min(bl[aa]*size,b);++i) a[i]+=c;</div><div class="line">	<span class="keyword">if</span>(bl[aa]!=bl[b])</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[b]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=b;++i)a[i]+=c;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=bl[aa]+<span class="number">1</span>;i&lt;=bl[b]<span class="number">-1</span>;++i) tag[i]+=c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span>&#123;</div><div class="line">	n=read(),size=<span class="built_in">sqrt</span>(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) a[i]=read();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) bl[i]=(i<span class="number">-1</span>)/size+<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span>  op,aa,b,c,i=<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">		op=read(),aa=read(),b=read(),c=read();</div><div class="line">		<span class="keyword">if</span>(!op)modify(aa,b,c);</div><div class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,a[b]+tag[bl[b]]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="数列分块2"><a href="#数列分块2" class="headerlink" title="数列分块2"></a>数列分块2</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">vector</span>;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;vec[<span class="number">100086</span>];</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;	</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">	<span class="keyword">char</span> c=getchar();</div><div class="line">	<span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>) &#123;<span class="keyword">if</span>(c==<span class="string">'0'</span>)f=<span class="number">-1</span>;c=getchar();&#125;</div><div class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">'9'</span>&amp;&amp;c&gt;=<span class="string">'0'</span>)x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">	<span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100007</span>;</div><div class="line"><span class="keyword">int</span> a[maxn],bl[maxn],tag[maxn],size;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">	vec[x].clear();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=(x<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=<span class="built_in">std</span>::min(x*size,n);++i)</div><div class="line">		vec[x].push_back(a[i]);</div><div class="line">	<span class="built_in">std</span>::sort(vec[x].begin(),vec[x].end());</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> aa,<span class="keyword">int</span> b,<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=aa;i&lt;=<span class="built_in">std</span>::min(bl[aa]*size,b);++i) a[i]+=c;</div><div class="line">	update(bl[aa]);</div><div class="line">	<span class="keyword">if</span>(bl[aa]!=bl[b]) &#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[b]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=b;++i)a[i]+=c;</div><div class="line">		update(bl[b]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=bl[aa]+<span class="number">1</span>;i&lt;=bl[b]<span class="number">-1</span>;++i) tag[i]+=c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> aa,<span class="keyword">int</span> b,<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> ans=<span class="number">0</span>;c*=c;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=aa;i&lt;=<span class="built_in">std</span>::min(b,bl[aa]*size);++i) </div><div class="line">		<span class="keyword">if</span>(a[i]+tag[bl[aa]]&lt;c)ans++;</div><div class="line">	<span class="keyword">if</span>(bl[aa]!=bl[b]) </div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[b]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=b;++i)</div><div class="line">			<span class="keyword">if</span>(a[i]+tag[bl[b]]&lt;c)ans++;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=bl[aa]+<span class="number">1</span>;i&lt;=bl[b]<span class="number">-1</span>;++i) &#123;</div><div class="line">		<span class="keyword">int</span> x=c-tag[i];</div><div class="line">		ans+=lower_bound(vec[i].begin(),vec[i].end(),x)-vec[i].begin();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span>&#123;</div><div class="line">	n=read(),size=<span class="built_in">sqrt</span>(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) a[i]=read();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) bl[i]=((i<span class="number">-1</span>)/size+<span class="number">1</span>),vec[bl[i]].push_back(a[i]);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=bl[n];i++)<span class="built_in">std</span>::sort(vec[i].begin(),vec[i].end());	</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span>  op,aa,b,c,i=<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">		op=read(),aa=read(),b=read(),c=read();</div><div class="line">		<span class="keyword">if</span>(!op)modify(aa,b,c);</div><div class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(aa,b,c));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="数列分块3"><a href="#数列分块3" class="headerlink" title="数列分块3"></a>数列分块3</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">vector</span>;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;vec[<span class="number">100086</span>];</div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;	</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">	<span class="keyword">char</span> c=getchar();</div><div class="line">	<span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>) &#123;<span class="keyword">if</span>(c==<span class="string">'0'</span>)f=<span class="number">-1</span>;c=getchar();&#125;</div><div class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">'9'</span>&amp;&amp;c&gt;=<span class="string">'0'</span>)x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">	<span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100007</span>;</div><div class="line"><span class="keyword">int</span> a[maxn],bl[maxn],tag[maxn],size;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">	vec[x].clear();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=(x<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=<span class="built_in">std</span>::min(x*size,n);++i)</div><div class="line">		vec[x].push_back(a[i]);</div><div class="line">	<span class="built_in">std</span>::sort(vec[x].begin(),vec[x].end());</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> aa,<span class="keyword">int</span> b,<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=aa;i&lt;=<span class="built_in">std</span>::min(bl[aa]*size,b);++i) a[i]+=c;</div><div class="line">	update(bl[aa]);</div><div class="line">	<span class="keyword">if</span>(bl[aa]!=bl[b]) &#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[b]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=b;++i)a[i]+=c;</div><div class="line">		update(bl[b]);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=bl[aa]+<span class="number">1</span>;i&lt;=bl[b]<span class="number">-1</span>;++i) </div><div class="line">		tag[i]+=c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> aa,<span class="keyword">int</span> b,<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> tmp,ret=<span class="number">-1</span>,retc=<span class="number">0x3f3f3f3f</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=aa;i&lt;=<span class="built_in">std</span>::min(b,bl[aa]*size);++i) </div><div class="line">		<span class="keyword">if</span>(c&gt;a[i]+tag[bl[aa]]) &#123;</div><div class="line">			tmp=(c-(a[i]+tag[bl[aa]]));</div><div class="line">			<span class="keyword">if</span>(tmp&lt;retc) retc=tmp,ret=a[i]+tag[bl[aa]];</div><div class="line">		&#125;</div><div class="line">		<span class="comment">//if(a[i]+tag[bl[aa]]&gt;=c)return a[i-1];</span></div><div class="line">	<span class="keyword">if</span>(bl[aa]!=bl[b]) </div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[b]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=b;++i)</div><div class="line">			<span class="keyword">if</span>(c&gt;a[i]+tag[bl[b]]) &#123;</div><div class="line">				tmp=(c-(a[i]+tag[bl[b]]));</div><div class="line">				<span class="keyword">if</span>(tmp&lt;retc) retc=tmp,ret=a[i]+tag[bl[b]];</div><div class="line">			&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=bl[aa]+<span class="number">1</span>;i&lt;=bl[b]<span class="number">-1</span>;++i) &#123;</div><div class="line">		<span class="keyword">int</span> x=c-tag[i];</div><div class="line">		<span class="keyword">int</span> loc=lower_bound(vec[i].begin(),vec[i].end(),x)-vec[i].begin()<span class="number">-1</span>;</div><div class="line">		<span class="keyword">if</span>(loc&lt;<span class="number">0</span>)<span class="keyword">continue</span>;</div><div class="line">		tmp=c-vec[i][loc]-tag[i];</div><div class="line">		<span class="keyword">if</span>(tmp&lt;retc) retc=tmp,ret=vec[i][loc]+tag[i];</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span>&#123;</div><div class="line">	<span class="comment">//std::cin&gt;&gt;a;std::cout&lt;&lt;a;</span></div><div class="line">	n=read(),size=<span class="built_in">sqrt</span>(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) a[i]=read();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) bl[i]=((i<span class="number">-1</span>)/size+<span class="number">1</span>),vec[bl[i]].push_back(a[i]);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=bl[n];i++)<span class="built_in">std</span>::sort(vec[i].begin(),vec[i].end());	</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span>  op,aa,b,c,i=<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">		op=read(),aa=read(),b=read(),c=read();</div><div class="line">		<span class="keyword">if</span>(!op)modify(aa,b,c);</div><div class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(aa,b,c));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">6</div><div class="line">123 321 245 654 232 233</div><div class="line">1 2 5 246</div><div class="line">0 2 4 666</div><div class="line">1 1 6 888</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="数列分块4"><a href="#数列分块4" class="headerlink" title="数列分块4"></a>数列分块4</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">int</span> n,m;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;	</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">	<span class="keyword">char</span> c=getchar();</div><div class="line">	<span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>) &#123;<span class="keyword">if</span>(c==<span class="string">'0'</span>)f=<span class="number">-1</span>;c=getchar();&#125;</div><div class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">'9'</span>&amp;&amp;c&gt;=<span class="string">'0'</span>)x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">	<span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100007</span>;</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span>  a[maxn];<span class="keyword">int</span> bl[maxn],size;</div><div class="line"><span class="keyword">long</span> <span class="keyword">long</span> tag[maxn],sum[maxn];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> aa,<span class="keyword">int</span> b,<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=aa;i&lt;=<span class="built_in">std</span>::min(bl[aa]*size,b);++i) a[i]+=c,sum[bl[i]]+=c;<span class="comment">//,[bl[a]]+=c;</span></div><div class="line">	<span class="keyword">if</span>(bl[aa]!=bl[b]) </div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[b]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=b;++i) a[i]+=c,sum[bl[i]]+=c;<span class="comment">//,tag[bl[b]]+=c;</span></div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=bl[aa]+<span class="number">1</span>;i&lt;=bl[b]<span class="number">-1</span>;++i) </div><div class="line">		tag[i]+=c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span>  <span class="title">query</span><span class="params">(<span class="keyword">int</span> aa,<span class="keyword">int</span> b,<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">	<span class="keyword">long</span> <span class="keyword">long</span> ans=<span class="number">0</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=aa;i&lt;=<span class="built_in">std</span>::min(b,bl[aa]*size);++i) </div><div class="line">		ans+=a[i]+tag[bl[aa]];</div><div class="line">	<span class="keyword">if</span>(bl[aa]!=bl[b]) </div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[b]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=b;++i)</div><div class="line">			ans+=a[i]+tag[bl[b]];</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=bl[aa]+<span class="number">1</span>;i&lt;=bl[b]<span class="number">-1</span>;++i) &#123;</div><div class="line">		ans+=sum[i]+tag[i]*size;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ans%c;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>  </span>&#123;</div><div class="line">	<span class="comment">//std::cin&gt;&gt;a;std::cout&lt;&lt;a;</span></div><div class="line">	n=read(),size=<span class="built_in">sqrt</span>(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) a[i]=read();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) bl[i]=((i<span class="number">-1</span>)/size+<span class="number">1</span>),sum[bl[i]]+=a[i];</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span>  op,aa,b,c,i=<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">		op=read(),aa=read(),b=read(),c=read();</div><div class="line">		<span class="keyword">if</span>(!op)modify(aa,b,c);</div><div class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(aa,b,c+<span class="number">1</span>));</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">6</div><div class="line">123 321 245 654 232 233</div><div class="line">1 2 5 246</div><div class="line">0 2 4 666</div><div class="line">1 1 6 888</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="数列分块5"><a href="#数列分块5" class="headerlink" title="数列分块5"></a>数列分块5</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::min;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span>  x=<span class="number">0</span>,op=<span class="number">1</span>;<span class="keyword">char</span> c=getchar();</div><div class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>)&#123;<span class="keyword">if</span>(c==<span class="string">'-'</span>)op=<span class="number">-1</span>;c=getchar();&#125;</div><div class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span>&amp;&amp;c&lt;=<span class="string">'9'</span>)x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">    <span class="keyword">return</span> x*op;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100007</span>;</div><div class="line"><span class="keyword">int</span> n,size;</div><div class="line"><span class="keyword">int</span> bl[maxn],a[maxn],sum[maxn],tag[maxn];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(tag[x])<span class="keyword">return</span>;</div><div class="line">    tag[x]=<span class="number">1</span>,sum[x]=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=(x<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=x*size;i++) &#123;</div><div class="line">        a[i]=<span class="built_in">sqrt</span>(a[i]),sum[x]+=a[i];</div><div class="line">        <span class="keyword">if</span>(a[i]&gt;<span class="number">1</span>)tag[x]=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=min(bl[l]*size,r);i++)</div><div class="line">        sum[bl[l]]-=a[i],a[i]=<span class="built_in">sqrt</span>(a[i]),sum[bl[l]]+=a[i];</div><div class="line">    <span class="keyword">if</span>(bl[l]!=bl[r])</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[r]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=r;i++)</div><div class="line">            sum[bl[r]]-=a[i],a[i]=<span class="built_in">sqrt</span>(a[i]),sum[bl[r]]+=a[i];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=bl[l]+<span class="number">1</span>;i&lt;=bl[r]<span class="number">-1</span>;i++)</div><div class="line">        update(i);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=min(bl[l]*size,r);i++) ans+=a[i];</div><div class="line">    <span class="keyword">if</span>(bl[l]!=bl[r])</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[r]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=r;i++)</div><div class="line">            ans+=a[i];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=bl[l]+<span class="number">1</span>;i&lt;=bl[r]<span class="number">-1</span>;i++)</div><div class="line">        ans+=sum[i];</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    n=read();size=<span class="built_in">sqrt</span>(n);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)a[i]=read();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) </div><div class="line">        bl[i]=(i<span class="number">-1</span>)/size+<span class="number">1</span>,sum[bl[i]]+=a[i];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> op,a,b,c,i=<span class="number">1</span>;i&lt;=n;i++) &#123;</div><div class="line">        op=read(),a=read(),b=read(),c=read();</div><div class="line">        <span class="keyword">if</span>(!op)add(a,b);</div><div class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(a,b));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="数列分块6"><a href="#数列分块6" class="headerlink" title="数列分块6"></a>数列分块6</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">vector</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100007</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="keyword">char</span> c=getchar();</div><div class="line">	<span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>) &#123;<span class="keyword">if</span>(c==<span class="string">'-'</span>)f=<span class="number">-1</span>;c=getchar();&#125;</div><div class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">'9'</span>&amp;&amp;c&gt;=<span class="string">'0'</span>) x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">	<span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;vec[maxn];</div><div class="line"><span class="keyword">int</span> a[maxn],bl[maxn],size,n;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> loc,<span class="keyword">int</span> w)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=bl[n];++i) &#123;</div><div class="line">		<span class="keyword">if</span>(loc&lt;=vec[i].size()) &#123;vec[i].insert(vec[i].begin()+loc<span class="number">-1</span>,w);<span class="keyword">return</span>;&#125;</div><div class="line">		loc-=vec[i].size();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> loc)</span> </span>&#123;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=bl[n];++i) &#123;</div><div class="line">		<span class="keyword">if</span>(loc&lt;=vec[i].size()) <span class="keyword">return</span> vec[i][loc<span class="number">-1</span>];</div><div class="line">		loc-=vec[i].size();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	n=read();size=<span class="built_in">sqrt</span>(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)a[i]=read();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)bl[i]=(i<span class="number">-1</span>)/size+<span class="number">1</span>,vec[bl[i]].push_back(a[i]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> op,aa,b,c,i=<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">		op=read(),aa=read(),b=read(),c=read();</div><div class="line">		<span class="keyword">if</span>(!op) insert(aa,b);</div><div class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(b));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="数列分块7"><a href="#数列分块7" class="headerlink" title="数列分块7"></a>数列分块7</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mod 10007</span></div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::min;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100007</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="keyword">char</span> c=getchar();</div><div class="line">	<span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>) &#123;<span class="keyword">if</span>(c==<span class="string">'-'</span>)f=<span class="number">-1</span>;c=getchar();&#125;</div><div class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">'9'</span>&amp;&amp;c&gt;=<span class="string">'0'</span>) x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">	<span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> tagm[maxn],taga[maxn];</div><div class="line"><span class="keyword">int</span> a[maxn],bl[maxn],size,n;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=(x<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=min(n,x*size);i++)</div><div class="line">        a[i]=(a[i]*tagm[x]+taga[x])%mod;</div><div class="line">    taga[x]=<span class="number">0</span>;tagm[x]=<span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Modify_Add</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> w)</span> </span>&#123;</div><div class="line">	reset(bl[l]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=min(r,bl[l]*size);++i) a[i]+=w,a[i]%=mod;</div><div class="line">	<span class="keyword">if</span>(bl[l]!=bl[r]) &#123;</div><div class="line">		reset(bl[r]);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[r]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=r;++i) </div><div class="line">			a[i]+=w,a[i]%=mod;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=bl[l]+<span class="number">1</span>;i&lt;=bl[r]<span class="number">-1</span>;++i) </div><div class="line">		taga[i]+=w,taga[i]%=mod;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">Modify_Mul</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> w)</span>  </span>&#123;</div><div class="line">	reset(bl[l]);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=min(bl[l]*size,r);++i) a[i]*=w,a[i]%=mod;</div><div class="line">	<span class="keyword">if</span>(bl[l]!=bl[r]) &#123;</div><div class="line">		reset(bl[r]);</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[r]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=r;++i) </div><div class="line">			a[i]*=w,a[i]%=mod;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=bl[l]+<span class="number">1</span>;i&lt;=bl[r]<span class="number">-1</span>;++i) </div><div class="line">		tagm[i]=tagm[i]*w%mod,taga[i]=taga[i]*w%mod;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	n=read();size=<span class="built_in">sqrt</span>(n);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)a[i]=read(),tagm[i]=<span class="number">1</span>;tagm[n+<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)bl[i]=(i<span class="number">-1</span>)/size+<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> op,aa,b,c,i=<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">		op=read(),aa=read(),b=read(),c=read()%mod;</div><div class="line">		<span class="keyword">if</span>(!op) Modify_Add(aa,b,c);</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="number">1</span>)Modify_Mul(aa,b,c);</div><div class="line">		<span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,(a[b]*tagm[bl[b]]+taga[bl[b]])%mod);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="数列分块8"><a href="#数列分块8" class="headerlink" title="数列分块8"></a>数列分块8</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::min;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">100007</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">	<span class="keyword">char</span> c=getchar();</div><div class="line">	<span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>) &#123;</div><div class="line">		<span class="keyword">if</span>(c==<span class="string">'-'</span>)f=<span class="number">-1</span>;</div><div class="line">		c=getchar();</div><div class="line">	&#125;<span class="keyword">while</span>(c&lt;=<span class="string">'9'</span>&amp;&amp;c&gt;=<span class="string">'0'</span>) x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">	<span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n,a[maxn],bl[maxn],tag[maxn],ans=<span class="number">0</span>,size;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">	ans=<span class="number">0</span>;</div><div class="line">	<span class="keyword">if</span>(tag[bl[l]]!=<span class="number">-1</span>) &#123;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[l]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=bl[l]*size;++i) </div><div class="line">			a[i]=tag[bl[l]];</div><div class="line">		tag[bl[l]]=<span class="number">-1</span>;</div><div class="line">		&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=l;i&lt;=min(bl[l]*size,r);++i)</div><div class="line">	ans+=a[i]==c,a[i]=c;</div><div class="line">	<span class="comment">//tag[bl[r]]=-1;</span></div><div class="line">	<span class="keyword">if</span>(bl[l]!=bl[r]) &#123;</div><div class="line">		<span class="keyword">if</span>(tag[bl[r]]!=<span class="number">-1</span>) &#123; </div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[r]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=bl[r]*size;++i) </div><div class="line">				a[i]=tag[bl[r]];</div><div class="line">			tag[bl[r]]=<span class="number">-1</span>;</div><div class="line">			&#125;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[r]<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=r;++i)</div><div class="line">			ans+=a[i]==c,a[i]=c;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=bl[l]+<span class="number">1</span>;i&lt;=bl[r]<span class="number">-1</span>;++i) &#123;</div><div class="line">		<span class="keyword">if</span>(tag[i]==c)ans+=size;</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(tag[i]==<span class="number">-1</span>) &#123;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> j=(i<span class="number">-1</span>)*size+<span class="number">1</span>;j&lt;=i*size;++j) </div><div class="line">				ans+=a[j]==c,a[j]=c;</div><div class="line">			tag[i]=c;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span> tag[i]=c;</div><div class="line">	&#125;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,ans);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	n=read();size=<span class="built_in">sqrt</span>(n);</div><div class="line">	<span class="built_in">memset</span>(tag,<span class="number">-1</span>,<span class="keyword">sizeof</span> tag);</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)a[i]=read();</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i)bl[i]=(i<span class="number">-1</span>)/size+<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> aa,b,c,i=<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">		aa=read(),b=read(),c=read();</div><div class="line">		solve(aa,b,c);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="数列分块9"><a href="#数列分块9" class="headerlink" title="数列分块9"></a>数列分块9</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;map&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">map</span>;</div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">vector</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">    <span class="keyword">char</span> c=getchar();</div><div class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>)&#123;<span class="keyword">if</span>(c==<span class="string">'-'</span>)f=<span class="number">-1</span>;c=getchar();&#125;</div><div class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span>&amp;&amp;c&lt;=<span class="string">'9'</span>)x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">    <span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">110007</span>;</div><div class="line"><span class="keyword">int</span> v[maxn],val[maxn];</div><div class="line"><span class="keyword">int</span> n,size,bl[maxn],id=<span class="number">0</span>,atmp[<span class="number">671</span>][<span class="number">671</span>],cnt[<span class="number">10086</span>];</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;vec[<span class="number">1007</span>];</div><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt;mp;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="built_in">memset</span>(cnt,<span class="number">0</span>,<span class="keyword">sizeof</span> cnt);</div><div class="line">    <span class="keyword">int</span> mcnt=<span class="number">0</span>,mans=<span class="number">0</span>; </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=(x<span class="number">-1</span>)*size+<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">        <span class="keyword">int</span> vu=v[i]; </div><div class="line">        cnt[vu]++;</div><div class="line">        <span class="keyword">if</span>(mcnt&lt;cnt[vu]||(mcnt==cnt[vu]&amp;&amp;val[vu]&lt;val[mans])) </div><div class="line">            mans=vu,mcnt=cnt[vu];</div><div class="line">        atmp[x][bl[i]]=mans;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">count</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> mans)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> upper_bound(vec[mans].begin(),vec[mans].end(),b)-lower_bound(vec[mans].begin(),vec[mans].end(),a);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> mans=atmp[bl[a]+<span class="number">1</span>][bl[b]<span class="number">-1</span>]; </div><div class="line">    <span class="keyword">int</span> mcnt=count(a,b,mans);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=a;i&lt;=<span class="built_in">std</span>::min(bl[a]*size,b);++i) &#123;</div><div class="line">        <span class="keyword">int</span> qcnt=count(a,b,v[i]);<span class="keyword">if</span>(qcnt&gt;mcnt||(qcnt==mcnt&amp;&amp;val[v[i]]&lt;val[mans])) mcnt=qcnt,mans=v[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(bl[a]!=bl[b]) </div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=(bl[b]<span class="number">-1</span>)*size;i&lt;=b;++i) &#123;</div><div class="line">            <span class="keyword">int</span> qcnt=count(a,b,v[i]);<span class="keyword">if</span>(qcnt&gt;mcnt||(qcnt==mcnt&amp;&amp;val[v[i]]&lt;val[mans])) mcnt=qcnt,mans=v[i];</div><div class="line">        &#125;</div><div class="line">    <span class="keyword">return</span> val[mans];</div><div class="line">&#125;   </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    n=read();size=<span class="built_in">sqrt</span>(n);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">        v[i]=read();</div><div class="line">        <span class="keyword">if</span>(!mp[v[i]]) </div><div class="line">            mp[v[i]]=++id,val[id]=v[i];</div><div class="line">        v[i]=mp[v[i]];</div><div class="line">        vec[v[i]].push_back(i);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) bl[i]=(i<span class="number">-1</span>)/size+<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=bl[n];++i)build(i);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> a,b,i=<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">        a=read(),b=read();</div><div class="line">		<span class="keyword">if</span>(a&gt;b)<span class="built_in">std</span>::swap(a,b);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(a,b));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>完~</p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2018/03/10/数列分块1-9/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-博弈论与SG函数">
    <header class="cube-excerpt-header">
        <h1><a href="/2018/02/28/博弈论与SG函数/">博弈论与SG函数</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2018-02-28
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/博弈论与SG函数/" class="cube-excerpt-tag-link">#博弈论与SG函数</a>
                
                <a href="/tags/博弈论/" class="cube-excerpt-tag-link">#博弈论</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h1 id="巴什博奕"><a href="#巴什博奕" class="headerlink" title="巴什博奕:"></a>巴什博奕:</h1><p>两个顶尖聪明的人在玩游戏，有nn个石子，每人可以随便拿1−m1−m个石子，不能拿的人为败者，问谁会胜利</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论:"></a>结论:</h2><p>设当前的石子数为$n=k∗(m+1)$即$n%(m+1)==0$时先手一定失败<br>HDU1846<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> C,N,M;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;C);</div><div class="line">    <span class="keyword">while</span>(C--) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;N,&amp;M);</div><div class="line">        <span class="keyword">if</span>(N%(M+<span class="number">1</span>)==<span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">"second\n"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"first\n"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>HDU4764<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN=<span class="number">1e6</span>+<span class="number">10</span>,INF=<span class="number">1e9</span>+<span class="number">10</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x,y;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;x,&amp;y)) &#123;</div><div class="line">        <span class="keyword">if</span>(!x&amp;&amp;!y) <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">if</span>( (x<span class="number">-1</span>)%(y+<span class="number">1</span>)==<span class="number">0</span> ) <span class="built_in">puts</span>(<span class="string">"Jiang\n"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"Tang\n"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="nim游戏"><a href="#nim游戏" class="headerlink" title="nim游戏:"></a>nim游戏:</h1><p>有两个顶尖聪明的人在玩游戏<br>有n堆石子，两个人可以从任意一堆石子中拿任意多个石子(不能不拿)，没法拿的人失败。问谁会胜利</p>
<h2 id="结论-1"><a href="#结论-1" class="headerlink" title="结论:"></a>结论:</h2><p>当$n$堆石子的数量异或和等于$0$时，先手必败，否则先手必胜</p>
<h3 id="简证"><a href="#简证" class="headerlink" title="简证:"></a>简证:</h3><p>定义当前状态为<br>P-position：在当前的局面下，先手必败<br>N-position：在当前的局面下，先手必胜<br>对于面对局面为<br>$0\ xor\ 0\ xor\ …\ 0 = 0$称它为p局面</p>
<p>若当前局面为<br>$a_1\ xor\ a_{2}\ …a_n = k$ 来说<br>我们可以通过改变一个$a_i$的比如$a_i\ xor \ k$值来使得上式的值为0,此时修改该操作的人为必败局面,由于$xor$计算的特殊性，我们知道一定有一个$a_i$最高位与$k$最高位的1是相同的，那么必然有$a_i\ xor\ k\ &lt;a_i$的,所以操作可为减法</p>
<p>对于局面<br>$a_1\ xor\ a_{2}\ …a_n = 0$<br>那么此时对于任何一种操作都会使得上式的值发生改变，也就是不为0<br>对与xor的性质,当每个位置的1都存在偶数个时，异或和为0,只改变一个$a_i$,一定会使得某个位置的1的个数发生改变<br>所以只有当先手面临$xor$和为0是，必胜<br><a href="https://www.luogu.org/problemnew/show/P2197" target="_blank" rel="external">luogu P2197 nim游戏</a><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> T;</div><div class="line">    <span class="comment">//scanf("%d",&amp;T);</span></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;T;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> n;T--;) &#123;</div><div class="line">        <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;n;</div><div class="line">        <span class="keyword">int</span> tmp=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> q,i=<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">            <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;q;tmp^=q;	</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(!tmp)<span class="built_in">puts</span>(<span class="string">"No"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"Yes"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//char a[10];scanf("%s",a);puts(a);</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="SG函数"><a href="#SG函数" class="headerlink" title="SG函数"></a>SG函数</h1><p>SG函数内容的理解借鉴自zyf学长,鸣谢！QUQ<br>对于nim游戏，你已经知道怎么做了<br>但是，要是稍加改变游戏规则，那么恐怕无法很快找出必胜策略</p>
<p>我们可以吧游戏抽象为一张图，每一个点代表一个状态，对于每个状态与他的子状态连一条有向边。那么，我们在这张有向无环图上引入SG函数</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>定义运算$mex()$,这是对于一个集合的运算,表示最小的不属于该集合的非负整数<br>例如$mex\{0,1,2,3\}=4;mex\{2,3,5\}=0$。<br>那么对于每个顶点的SG值为:<br>后继中未出现过的最小值</p>
<script type="math/tex; mode=display">sg(x)=mex\{sg(y)\}</script><p>y为x的后继</p>
<h2 id="SG函数的性质"><a href="#SG函数的性质" class="headerlink" title="SG函数的性质"></a>SG函数的性质</h2><p>首先对于出度为0的点，他的SG值为0<br>对于一个SG值为0的点x，他的后继y都满足sg(y)!=0,y的后继中一定有存在一个点的SG值为0<br>诶,是不是和刚才nim游戏很像<br>所以当SG(x)=0时,x代表了p局面</p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>考虑有向图上有n个棋子,每次可以移动一颗,不能移动者lose,这时候怎样找到必胜策略呢?<br>我们来考虑每个顶点的SG值得含义,当$sg(x)=k$时，x的后继y的$sg(y)=1\ -&gt;\ k$也就是说，某个棋子进行移动后sg值是一定会发生改变的<br>类比普通的nim游戏,Nim游戏的一种必胜策略就是把$a_i$变为k,<br>那么,把第i个棋子移动到一个SG值为k的点上就是一种必胜策略<br>hhhh,也就是说Nim游戏的一种必胜策略对应着这n个棋子的必胜策略</p>
<ul>
<li><strong>那么这个游戏P局面就棋子所在位置的SG函数异或和为0的时候。</strong></li>
</ul>
<h1 id="经典的博弈问题"><a href="#经典的博弈问题" class="headerlink" title="经典的博弈问题"></a>经典的博弈问题</h1><p>再来说一下几类经典的博弈问题</p>
<h2 id="Anti-Nim游戏和SJ定理"><a href="#Anti-Nim游戏和SJ定理" class="headerlink" title="Anti-Nim游戏和SJ定理"></a>Anti-Nim游戏和SJ定理</h2><p>有两个顶尖聪明的人在玩游戏<del>(他们一个是崩崩崩玩家一个是舰娘玩家)</del>,游戏规则是这样的：<br>有n堆石子，两个人可以从任意一堆石子中拿任意多个石子(不能不拿)，拿走最后一个石子的人失败。问谁会胜利?</p>
<h3 id="结论-2"><a href="#结论-2" class="headerlink" title="结论"></a>结论</h3><p>先手必胜当且仅当：<br>所有堆的石子数都为1且游戏的SG值为0<br>有些堆的石子数大于1且游戏的SG值不为0</p>
<h3 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h3><p>1)游戏有三种情况<br> 每堆只有一个石子</p>
<ul>
<li>异或和为0先手必胜</li>
<li>异或和不为0先手必败<br>2)只存在一堆石子数&gt;1,则先手必胜<br>可以发现，在这种情况下异或值一定 ！= 0<br>并且先手一定可以使剩下的奇数个石子变为个数为1的堆<br>3)存在2堆以上的石子数&gt;1<br>-异或和=0时先手必败<br>-异或和!=0先手必胜<br>那么<br>考虑nim游戏，当异或和=0时,洗衣不操作都会使异或和！=0,相反同样….符合NP状态的转换<br>不断进行转换会在一个时刻变为 ‘只有一堆大于1’ 的局面,而该局面一定是有 ‘两堆&gt;1且异或和=0’ 的局面 转来的,所以 ‘两堆&gt;1且异或和=0’ 的局面一定会在某一时刻转化为  ‘只有一堆大于1’ 的 先手必胜局面 ,也就是说是先手必败态;<br>其他同理可证<br><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=1022" target="_blank" rel="external">bzoj 1022: [SHOI2008]小约翰的游戏John</a></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">    <span class="keyword">char</span> c=getchar() ;</div><div class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>)  &#123;</div><div class="line">        <span class="keyword">if</span>(c==<span class="string">'-'</span>)f=<span class="number">-1</span>;</div><div class="line">        c=getchar();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span>(c&lt;=<span class="string">'9'</span>&amp;&amp;c&gt;=<span class="string">'0'</span>)x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">    <span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> a;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> n,T=read();T--;) &#123;</div><div class="line">        n=read();<span class="keyword">bool</span> op=<span class="number">1</span>;<span class="keyword">int</span> tmp=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;++i) &#123;</div><div class="line">            a=read();<span class="keyword">if</span>(a!=<span class="number">1</span>)op=<span class="number">0</span>;</div><div class="line">            tmp^=a;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>((op&amp;&amp;!tmp) || (!op&amp;&amp;tmp))<span class="built_in">puts</span>(<span class="string">"John"</span>);</div><div class="line">        <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">"Brother"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SJ定理"><a href="#SJ定理" class="headerlink" title="SJ定理"></a>SJ定理</h3><p>定理：SJ定理</p>
<p>对于任意一个Anti-SG游戏，如果我们规定当局面中所有的单一游戏的SG值为0时，游戏结束，则先手必胜当且仅当：</p>
<blockquote>
<p> (1)游戏的SG函数不为0且游戏中某个单一游戏的SG函数大于 1;  (2)游戏的SG函数为0且游戏中没有单一游戏的SG函数大于1。</p>
</blockquote>
<h2 id="Multi-SG"><a href="#Multi-SG" class="headerlink" title="Multi-SG"></a>Multi-SG</h2><p>有n堆石子，两个人可以从任意一堆石子中拿任意多个石子(不能不拿)或把一堆数量不少于2石子分为两堆不为空的石子，没法拿的人失败。问谁会胜利</p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>用sg函数来解决<br>操作1与nim游戏无异,对与一个石子数为k的点来说,后继可以为1..k<br>操作二实际上是将一个游戏分解为两个游戏，根据SG定理，两个有的的和为两个游戏的SG函数值得异或，我们可以通过异或运算把两个单一游戏连接到一起，作为一个后继状态<br>要是数据范围很大，SG函数就不能用了，有结论</p>
<script type="math/tex; mode=display">SG\left( x\right) =\begin{cases}x-1\left( x\mod4=0\right) \\ x\left( x\mod4=1 \lor 2\right) \\ x+1\left( x\mod4=3\right) \end{cases}</script><p>hhhhhhhhhhh</p>
<h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><p>根据上面的游戏,定义Multi-SG游戏</p>
<ul>
<li><p>Multi-SG 游戏规定，在符合拓扑原则的前提下，一个单一游戏的后继可以为多个单一游戏。</p>
</li>
<li>Multi-SG其他规则与SG游戏相同。注意在这里要分清楚后继与多个单一游戏<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><a href="http://acm.hdu.edu.cn/showproblem.php?pid=3032" target="_blank" rel="external">HDU 3032</a><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1001</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">char</span> c=getchar();<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>)&#123;<span class="keyword">if</span>(c==<span class="string">'-'</span>)f=<span class="number">-1</span>;c=getchar();&#125;</div><div class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span>&amp;&amp;c&lt;=<span class="string">'9'</span>)&#123;x=x*<span class="number">10</span>+c-<span class="string">'0'</span>;c=getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> a[maxn],sg[maxn];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> T=read();</div><div class="line">    <span class="keyword">while</span>(T--) &#123;</div><div class="line">        <span class="keyword">int</span> n=read();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) a[i]=read();</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">            <span class="keyword">if</span>(a[i] % <span class="number">4</span> == <span class="number">0</span>) sg[i] = a[i]<span class="number">-1</span>;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(a[i]%<span class="number">4</span>==<span class="number">1</span>||a[i]%<span class="number">4</span>==<span class="number">2</span>) sg[i] = a[i];</div><div class="line">            <span class="keyword">else</span> sg[i] = a[i]+<span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</div><div class="line">            ans^=sg[i];</div><div class="line">        <span class="keyword">if</span>(ans)<span class="built_in">puts</span>(<span class="string">"Alice"</span>);</div><div class="line">		<span class="keyword">else</span>  <span class="built_in">puts</span>(<span class="string">"Bob"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p><a href="http://poj.org/problem?id=2311" target="_blank" rel="external">POJ 2311</a><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">3824</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">char</span> c=getchar();<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>)&#123;<span class="keyword">if</span>(c==<span class="string">'-'</span>)f=<span class="number">-1</span>;c=getchar();&#125;</div><div class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span>&amp;&amp;c&lt;=<span class="string">'9'</span>)&#123;x=x*<span class="number">10</span>+c-<span class="string">'0'</span>;c=getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x*f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> sg[maxn][maxn];<span class="comment">//当前剩余i行 j列的sg函数 </span></div><div class="line"><span class="keyword">int</span> vis[maxn];</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n=<span class="number">201</span>,m=<span class="number">201</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=n;i++) </div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">2</span>;j&lt;=n;j++) &#123;</div><div class="line">            <span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="keyword">sizeof</span>(vis));</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">2</span>;k&lt;=i<span class="number">-2</span>;k++) vis[sg[k][j]^sg[i-k][j]]=<span class="number">1</span>;    </div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">2</span>;k&lt;=j<span class="number">-2</span>;k++) vis[sg[i][k]^sg[i][j-k]]=<span class="number">1</span>;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;;k++) <span class="keyword">if</span>(!vis[k]) &#123;sg[i][j]=k;<span class="keyword">break</span>;&#125;</div><div class="line">        &#125;</div><div class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;m)!=EOF)</div><div class="line">        <span class="built_in">puts</span>(sg[n][m] ? <span class="string">"WIN"</span> : <span class="string">"LOSE"</span>);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2940" target="_blank" rel="external">BZOJ 2940</a></p>
<p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=1188" target="_blank" rel="external">BZOJ 1188</a></p>
<p><a href="">洛谷 3235</a></p>
<h2 id="Every-SG"><a href="#Every-SG" class="headerlink" title="Every-SG"></a>Every-SG</h2><p>给定一张无向图，上面有一些棋子，两个顶尖聪明的人在做游戏，每人每次必须将可以移动的棋子进行移动，不能移动的人输</p>
<h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><p>这样的话，能赢得游戏必须赢<br>为了赢得最后的胜利<br>当你知道某一个单一游戏一定会输的话，你需要尽力缩短游戏的时间，相反的当你知道某一个游戏一定会赢的话，那么就需要尽力延长游戏的时间</p>
<h3 id="定义-2"><a href="#定义-2" class="headerlink" title="定义:"></a>定义:</h3><ul>
<li>对于还没有结束的单一游戏，游戏者必须对该 游戏进行一步决策；</li>
<li>Every-SG游戏的其他规则与普通 SG游戏相同</li>
</ul>
<p>Every-SG游戏与普通游戏最大的不同就是他多了一维时间<br>对于SG的值为0,我们需要周到最少走多少步才能结束，对于SG值不为0的点我们需要最多走多少步结束<br>我们用step变量来记录这个步数</p>
<script type="math/tex; mode=display">step(u) = \begin{cases} 0, & \text{$u为终止状态$}\\ max\{step(v)\}, & \text{ $sg(u)\neq 0\land v为u的后继\land sg(v)=0$ }\\ min\{step(v)\}, & \text{$sg(u)=0\land v为u的后继$} \end{cases}</script><h3 id="定理"><a href="#定理" class="headerlink" title="定理"></a>定理</h3><p>对于Every-SG游戏先手必胜当且仅当单一游戏中最大的step为奇数。<br>定理是显然的：</p>
<blockquote>
<p>对于Every-SG游戏先手必胜当且仅当单一游戏中最大的step为奇数。</p>
</blockquote>
<p>定理是显然的：最大的单一游戏步数如果是奇数的话那么肯定是先手取得进行最后一步，否则一定是对手取走最后一个棋子。<br><a href="http://acm.hdu.edu.cn/showproblem.php?pid=3595" target="_blank" rel="external">HDU 3595 GG and MM</a><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">balabala<span class="comment">//我还没写QUQ</span></div></pre></td></tr></table></figure></p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2018/02/28/博弈论与SG函数/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-bzoj 1005 [HNOI2008]明明的烦恼">
    <header class="cube-excerpt-header">
        <h1><a href="/2018/02/21/bzoj 1005 [HNOI2008]明明的烦恼/">bzoj 1005 [HNOI2008]明明的烦恼</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2018-02-21
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/数学/" class="cube-excerpt-tag-link">#数学</a>
                
                <a href="/tags/排列组合/" class="cube-excerpt-tag-link">#排列组合</a>
                
                <a href="/tags/prufer序/" class="cube-excerpt-tag-link">#prufer序</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h3 id="题目链接"><a href="#题目链接" class="headerlink" title="题目链接:"></a>题目链接:</h3><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=1005" target="_blank" rel="external">bzoj 1005: [HNOI2008]明明的烦恼</a></p>
<h3 id="题解"><a href="#题解" class="headerlink" title="题解:"></a>题解:</h3><p>首先要了解prufer序列<br>对于每个prufer序列都对应唯一的一棵树,对于该规定了度数的点也就规定了该店在prufer序列中出现的次数,那么就是求prufer序列的方案数也就是可重复序列的全排列。<br>首先只考虑规定度数得点设其度数为d[i],有k个,那么他在prufer中出现的次数就是d[i]-1<br>设<script type="math/tex">tot=\sum_i^{k}d[i]-1</script><br>那么可重排列方案数为</p>
<script type="math/tex; mode=display">C_{tot}^{d[1]-1}*C_{tot-d[1]-1}^{d[2]-1}*\ldots C_{d[k]-1}^{d[k]-1}</script><p>然后在乘上$C_{n-2}^{tot}$选点方案<br>考虑非规定度数点的选取方案<br>对于没有限制的点，直接有 $(n-k)^{n-2-tot}$种可选。<br>答案为无限制与有限制向乘<br>然后，高精，为了不超时，用质数表来优化。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**************************************************************</span></div><div class="line">    Problem: 1005</div><div class="line">  为了不超时，用质数表来优化。</div><div class="line">    Language: C++</div><div class="line">    Result: Accepted</div><div class="line">    Time:640 ms</div><div class="line">    Memory:876 kb</div><div class="line">****************************************************************/</div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">int</span> prime[<span class="number">1000</span>]=&#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">67</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">79</span>,<span class="number">83</span>,<span class="number">89</span>,<span class="number">97</span>,<span class="number">101</span>,<span class="number">103</span>,<span class="number">107</span>,<span class="number">109</span>,<span class="number">113</span>,<span class="number">127</span>,<span class="number">131</span>,<span class="number">137</span>,<span class="number">139</span>,<span class="number">149</span>,<span class="number">151</span>,<span class="number">157</span>,<span class="number">163</span>,<span class="number">167</span>,<span class="number">173</span>,<span class="number">179</span>,<span class="number">181</span>,<span class="number">191</span>,<span class="number">193</span>,<span class="number">197</span>,<span class="number">199</span>,<span class="number">211</span>,<span class="number">223</span>,<span class="number">227</span>,<span class="number">229</span>,<span class="number">233</span>,<span class="number">239</span>,<span class="number">241</span>,<span class="number">251</span>,<span class="number">257</span>,<span class="number">263</span>,<span class="number">269</span>,<span class="number">271</span>,<span class="number">277</span>,<span class="number">281</span>,<span class="number">283</span>,<span class="number">293</span>,<span class="number">307</span>,<span class="number">311</span>,<span class="number">313</span>,<span class="number">317</span>,<span class="number">331</span>,<span class="number">337</span>,<span class="number">347</span>,<span class="number">349</span>,<span class="number">353</span>,<span class="number">359</span>,<span class="number">367</span>,<span class="number">373</span>,<span class="number">379</span>,<span class="number">383</span>,<span class="number">389</span>,<span class="number">397</span>,<span class="number">401</span>,<span class="number">409</span>,<span class="number">419</span>,<span class="number">421</span>,<span class="number">431</span>,<span class="number">433</span>,<span class="number">439</span>,<span class="number">443</span>,<span class="number">449</span>,<span class="number">457</span>,<span class="number">461</span>,<span class="number">463</span>,<span class="number">467</span>,<span class="number">479</span>,<span class="number">487</span>,<span class="number">491</span>,<span class="number">499</span>,<span class="number">503</span>,<span class="number">509</span>,<span class="number">521</span>,<span class="number">523</span>,<span class="number">541</span>,<span class="number">547</span>,<span class="number">557</span>,<span class="number">563</span>,<span class="number">569</span>,<span class="number">571</span>,<span class="number">577</span>,<span class="number">587</span>,<span class="number">593</span>,<span class="number">599</span>,<span class="number">601</span>,<span class="number">607</span>,<span class="number">613</span>,<span class="number">617</span>,<span class="number">619</span>,<span class="number">631</span>,<span class="number">641</span>,<span class="number">643</span>,<span class="number">647</span>,<span class="number">653</span>,<span class="number">659</span>,<span class="number">661</span>,<span class="number">673</span>,<span class="number">677</span>,<span class="number">683</span>,<span class="number">691</span>,<span class="number">701</span>,<span class="number">709</span>,<span class="number">719</span>,<span class="number">727</span>,<span class="number">733</span>,<span class="number">739</span>,<span class="number">743</span>,<span class="number">751</span>,<span class="number">757</span>,<span class="number">761</span>,<span class="number">769</span>,<span class="number">773</span>,<span class="number">787</span>,<span class="number">797</span>,<span class="number">809</span>,<span class="number">811</span>,<span class="number">821</span>,<span class="number">823</span>,<span class="number">827</span>,<span class="number">829</span>,<span class="number">839</span>,<span class="number">853</span>,<span class="number">857</span>,<span class="number">859</span>,<span class="number">863</span>,<span class="number">877</span>,<span class="number">881</span>,<span class="number">883</span>,<span class="number">887</span>,<span class="number">907</span>,<span class="number">911</span>,<span class="number">919</span>,<span class="number">929</span>,<span class="number">937</span>,<span class="number">941</span>,<span class="number">947</span>,<span class="number">953</span>,<span class="number">967</span>,<span class="number">971</span>,<span class="number">977</span>,<span class="number">983</span>,<span class="number">991</span>,<span class="number">997</span>&#125;;</div><div class="line"><span class="keyword">int</span> n,d[<span class="number">1010</span>],s[<span class="number">200</span>],k=<span class="number">0</span>,sum=<span class="number">0</span>,base=<span class="number">10000</span>;</div><div class="line"><span class="keyword">struct</span> BigInt &#123;</div><div class="line">    <span class="keyword">int</span> len,a[<span class="number">10007</span>];</div><div class="line">    BigInt() &#123;</div><div class="line">        len=<span class="number">1</span>; <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span>(a));a[<span class="number">0</span>]=<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> &amp; <span class="keyword">operator</span>[](<span class="keyword">int</span> x) &#123;</div><div class="line">        <span class="keyword">return</span> a[x];</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d"</span>,a[len<span class="number">-1</span>]);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=len<span class="number">-2</span>;i&gt;=<span class="number">0</span>;i--) <span class="built_in">printf</span>(<span class="string">"%04d"</span>,a[i]);</div><div class="line">        <span class="built_in">puts</span>(<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"> </div><div class="line">BigInt <span class="keyword">operator</span>*(BigInt x,<span class="keyword">int</span> y) &#123;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;x.len;i++)</div><div class="line">    x[i]*=y;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;x.len;i++) </div><div class="line">        x[i+<span class="number">1</span>]+=x[i]/base,x[i]%=base;</div><div class="line">    <span class="keyword">while</span>(x[x.len]) </div><div class="line">        x[x.len]+=x[x.len<span class="number">-1</span>]/base, x[x.len<span class="number">-1</span>]%=base, x.len++;</div><div class="line">    <span class="keyword">return</span> x;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">mul</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;    </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">168</span>;j++)&#123;</div><div class="line">        <span class="keyword">while</span>(x%prime[j]==<span class="number">0</span>) &#123;</div><div class="line">            x/=prime[j];</div><div class="line">            s[j]+=y;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;n);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) &#123;</div><div class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;d[i]);</div><div class="line">        <span class="keyword">if</span>(d[i]==<span class="number">-1</span>) k++;</div><div class="line">        <span class="keyword">else</span> sum+=d[i]<span class="number">-1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(sum&gt;n<span class="number">-2</span>) &#123;</div><div class="line">        <span class="built_in">puts</span>(<span class="string">"0"</span>); <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;sum;i++)</div><div class="line">		mul(n<span class="number">-2</span>-i,<span class="number">1</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++) </div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;d[i];j++)</div><div class="line">            mul(j,<span class="number">-1</span>);</div><div class="line">    mul(k,n-sum<span class="number">-2</span>);</div><div class="line">    BigInt ans;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">200</span>;i++) </div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;s[i];j++)</div><div class="line">            ans=ans*prime[i];</div><div class="line">    ans.print();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2018/02/21/bzoj 1005 [HNOI2008]明明的烦恼/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-bzoj 2301 HAOI2011 Problem b">
    <header class="cube-excerpt-header">
        <h1><a href="/2018/02/21/bzoj 2301 HAOI2011 Problem b/">bzoj 2301 HAOI2011 Problem b</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2018-02-21
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/数学/" class="cube-excerpt-tag-link">#数学</a>
                
                <a href="/tags/莫比乌斯反演/" class="cube-excerpt-tag-link">#莫比乌斯反演</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h3 id="题目链接"><a href="#题目链接" class="headerlink" title="题目链接"></a>题目链接</h3><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2301" target="_blank" rel="external">BZOJ 2301 HAOI2011 Problem b</a></p>
<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><script type="math/tex; mode=display">\sum_{i=1}^n\sum_{j=1}^m[gcd(i,j)==k]</script><script type="math/tex; mode=display">=\sum_{i=1}^{? \dfrac{n}{k}?}\sum_{j=1}^{?\dfrac{m}{k}?}[gcd(i,j)==1]</script><p>利用函数f(x)表示x|(gcd(i,j))中ij的对数,那么原函数:</p>
<script type="math/tex; mode=display">=\sum_{i=1}^{? \dfrac{n}{k}?}\sum_{j=1}^{?\dfrac{m}{k}?}\sum_{d|gcd(i,j)}\mu(d)</script><script type="math/tex; mode=display">=\sum_{d=1}^{min(\dfrac{n}{k},\dfrac{m}{k})} \mu(d)*\sum_{d|i,i\leq\dfrac{n}{k}}\sum_{d|j,j\leq\dfrac{m}{k}}1</script><script type="math/tex; mode=display">\sum_{d=1}^{min(?\dfrac{n}{k}?,?\dfrac{m}{k}?)} \mu(d)*?\dfrac{n}{k}?*?\dfrac{m}{k}?)</script><p>$?\dfrac{n}{k}?$最多只有$2\sqrt{n}$个取值,预处理$\mu(d)$ $O(\sqrt{n})$回答</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">50007</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>;</div><div class="line">    <span class="keyword">char</span> c=getchar();</div><div class="line">    <span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>)c=getchar();</div><div class="line">    <span class="keyword">while</span>(c&gt;=<span class="string">'0'</span>&amp;&amp;c&lt;=<span class="string">'9'</span>)x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">    <span class="keyword">return</span> x;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> n,prime[maxn];</div><div class="line"><span class="keyword">bool</span> vis[maxn];<span class="keyword">long</span> <span class="keyword">long</span> mu[maxn];</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">get_rj</span><span class="params">()</span> </span>&#123;</div><div class="line">    mu[<span class="number">1</span>]=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=maxn<span class="number">-1</span>;i++) &#123;</div><div class="line">        <span class="keyword">if</span>(!vis[i]) prime[++prime[<span class="number">0</span>]]=i,mu[i]=<span class="number">-1</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;=prime[<span class="number">0</span>]&amp;&amp;i*prime[j]&lt;=maxn<span class="number">-1</span>;j++) &#123;</div><div class="line">            vis[i*prime[j]]=<span class="number">1</span>;</div><div class="line">            <span class="keyword">if</span>(i%prime[j]==<span class="number">0</span>) &#123;</div><div class="line">                mu[i*prime[j]]=<span class="number">0</span>;<span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            mu[i*prime[j]]=-mu[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=maxn<span class="number">-1</span>;i++) mu[i]+=mu[i<span class="number">-1</span>];</div><div class="line">&#125;</div><div class="line"><span class="function">LL <span class="title">calc</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> m,<span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">    n/=k;m/=k;</div><div class="line">    <span class="keyword">if</span>(n&gt;m) <span class="built_in">std</span>::swap(n,m);</div><div class="line">    LL ans=<span class="number">0</span>;<span class="keyword">int</span> next=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i=next+<span class="number">1</span>) &#123;</div><div class="line">        next=<span class="built_in">std</span>::min(n/(n/i),m/(m/i));</div><div class="line">        ans+=(mu[next]-mu[i<span class="number">-1</span>])*(n/i)*(m/i);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ans;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">    get_rj();</div><div class="line">    <span class="keyword">int</span> T=read();</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> a,b,c,d,k;T--;) &#123;</div><div class="line">        a=read();b=read();c=read();d=read();k=read();</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,calc(b,d,k)-calc(a<span class="number">-1</span>,d,k)-calc(b,c<span class="number">-1</span>,k)+calc(a<span class="number">-1</span>,c<span class="number">-1</span>,k));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2018/02/21/bzoj 2301 HAOI2011 Problem b/">Read More</a>
    </footer>
</div>

<div class="cube-excerpt" id="cube-excerpt-hdu 1425 Happy 2004">
    <header class="cube-excerpt-header">
        <h1><a href="/2018/02/10/hdu 1425 Happy 2004/">hdu 1425 Happy 2004</a></h1>
        <div class="cube-excerpt-header-msg">
            <div class="cube-excerpt-date">
                <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
                2018-02-10
            </div>
            <div class="cube-excerpt-tags">
                <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
                
                <a href="/tags/数学/" class="cube-excerpt-tag-link">#数学</a>
                
                <a href="/tags/积性函数/" class="cube-excerpt-tag-link">#积性函数</a>
                
            </div>
        </div>
    </header>
    <article class="cube-excerpt-entry cube-markdown">
        
        
           <h3 id="题目链接"><a href="#题目链接" class="headerlink" title="题目链接"></a>题目链接</h3><p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=1452" target="_blank" rel="external">hdu 1425 Happy 2004</a></p>
<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>题目大意:<br>求</p>
<script type="math/tex; mode=display">\sum_{d|2004^{x}}d mod 29</script><p>记为$s(2004^x)$</p>
<p>$s(2004^{x})= s(2^2X)) <em> s(3^X) </em> s(167^X)$</p>
<p>$167 \ mod \ 29 = 22 $</p>
<p>$s(2004^X) = s(2^{2X}) <em> s(3^{X})) </em> s(22^X)$<br>此时底数变为了质数<br>如果p是素数<br>$s(p^n)=1+p+p^2+…+p^n= (p^{n+1}-1) / (p-1)$<br>上面的式子带下来,写代码就好了<br>对于除法取mod需要求逆元<br>29为素数-&gt;快速幂<br>或者,打个表不就好了嘛233</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;</div><div class="line">	<span class="keyword">char</span> c=getchar();</div><div class="line">	<span class="keyword">while</span>(c&lt;<span class="string">'0'</span>||c&gt;<span class="string">'9'</span>)c=getchar();</div><div class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">'9'</span>&amp;&amp;c&gt;=<span class="string">'0'</span>)x=x*<span class="number">10</span>+c-<span class="string">'0'</span>,c=getchar();</div><div class="line">	<span class="keyword">return</span> x;</div><div class="line">&#125;</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> mod 29</span></div><div class="line"><span class="keyword">int</span> x,a,b,c;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">pow</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> p)</span> </span>&#123;</div><div class="line">	<span class="keyword">int</span> ret=<span class="number">1</span>;</div><div class="line">	<span class="keyword">for</span>(;p;p&gt;&gt;=<span class="number">1</span>,a=a*a%mod) &#123;</div><div class="line">		<span class="keyword">if</span>(p&amp;<span class="number">1</span>)ret=ret*a%mod;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> ret;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</div><div class="line">		x=read();</div><div class="line">		<span class="keyword">if</span>(!x)<span class="keyword">break</span>;</div><div class="line">		a=<span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">2</span>*x+<span class="number">1</span>);</div><div class="line">		b=<span class="built_in">pow</span>(<span class="number">3</span>,x+<span class="number">1</span>);</div><div class="line">		c=<span class="built_in">pow</span>(<span class="number">22</span>,x+<span class="number">1</span>);</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,(a<span class="number">-1</span>)*(b<span class="number">-1</span>)*<span class="number">15</span>*(c<span class="number">-1</span>)*<span class="number">18</span>%mod);</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
        
    </article>
    <footer class="cube-excerpt-footer">
        <a class="cube-excerpt-more" href="/2018/02/10/hdu 1425 Happy 2004/">Read More</a>
    </footer>
</div>



<ul class="cube-pagination cube-pagination-6">
    
    <li class="cube-pagination-prev disabled">
        <span>« Prev</span>
    </li>
    
    
        
            
            <li class="cube-pagination-index disabled">
                <span>1</span>
            </li>
            
        
            
            <li class="cube-pagination-index">
                <a href="/page/2">2</a>
            </li>
            
        
    

    
    <li class="cube-pagination-next">
        <a href="/page/2/">Next »</a>
    </li>
    
</ul>

<!--其他组件后续添加-->
        </div>
        <div class="cube-right">
            

<div class="cube-search cube-sidebar" id="cube-search">
    <div class="search-container">
        <input type="text" placeholder="Search" class="cube-search-input" id="cube-search-input">
        <i class="cube-icon cube-icon-search cube-search-submit" aria-hidden="true"></i>
    </div>
    <!-- TODO 通过给window赋一个全局变量，通过脚本赋值 -->
</div>
<script>
    (function (window) {
        'use strict';
        window.searchModule = {}
        window.searchModule.JSONUrl = '/content.json'
        window.searchModule.rootUrl = '/'
    })(window)
</script>
<div class="cube-search-form">
    <div class="cube-search-control">
        <input type="text" placeholder="Search" class="search-input">
        <a class="close-button">
            <i class="cube-icon cube-close" aria-hidden="true"></i>
        </a>
    </div>
    <div class="cube-search-result"></div>
</div>


<div class="cube-author cube-sidebar" id="cube-author">
    
    
    <span>11101001</span>
    
    
    <a title="&lt;script type=&quot;text/javascript&quot; src=&quot;https://api.lwl12.com/hitokoto/main/get?encode=js&amp;charset=utf-8&quot;&gt;&lt;/script&gt;&lt;div id=&quot;lwlhitokoto&quot;&gt;&lt;script&gt;lwlhitokoto()&lt;/script&gt;&lt;/div&gt;">&lt;script type=&quot;text/javascript&quot; src=&quot;https://api.lwl12.com/hitokoto/main/get?encode=js&amp;charset=utf-8&quot;&gt;&lt;/script&gt;&lt;div id=&quot;lwlhitokoto&quot;&gt;&lt;script&gt;lwlhitokoto()&lt;/script&gt;&lt;/div&gt;</a>
    
    <div class="count">
        <a class="count articles"><span>20</span>Article</a>
        <a class="count tags"><span>20</span>Tags</a>
        <a class="count categories"><span>10</span>Categories</a>
    </div>
</div>



<div class="cube-music cube-sidebar" id="cube-music">
    <div class="cube-player aplayer" id="cube-player"></div>
</div>
<script>
    (function (window) {
        window.musicModule = {}
        window.musicModule.musicConfig = '{"narrow":false,"autoplay":false,"showlrc":3,"theme":"#b7daff","mutex":true,"mode":"circulation","preload":"auto","listmaxheight":"513px","music":[{"title":"Dear friends","author":"TRIPLANE","url":"http://cube-1252774894.cosgz.myqcloud.com/music/source/TRIPLANE - Dear friends.mp3","lrc":"http://cube-1252774894.cosgz.myqcloud.com/music/lrc/Dear friends - TRIPLANE.lrc","pic":"http://cube-1252774894.cosgz.myqcloud.com/music/image/TRIPLANE - Dear friends.jpg"},{"title":"Butter-Fly","author":"和田光司","url":"http://cube-1252774894.cosgz.myqcloud.com/music/source/和田光司 - Butter-Fly (ピアノヴァージョン).mp3","lrc":"http://cube-1252774894.cosgz.myqcloud.com/music/lrc/Butter-Fly (ピアノヴァージョン) - 和田光司.lrc","pic":"http://cube-1252774894.cosgz.myqcloud.com/music/image/和田光司 - Butter-Fly (ピアノヴァージョン).jpg"},{"title":"宵闇花火","author":"葉月ゆら","url":"http://cube-1252774894.cosgz.myqcloud.com/music/source/葉月ゆら - 宵闇花火.mp3","lrc":"http://cube-1252774894.cosgz.myqcloud.com/music/lrc/宵闇花火 - 葉月ゆら.lrc","pic":"http://cube-1252774894.cosgz.myqcloud.com/music/image/葉月ゆら - 宵闇花火.jpg"}]}'
        window.musicModule.lrcConfig = {
            open: 'Open Lyrics',
            close: 'Close Lyrics'
        }
    })(window)
</script>



<div class="cube-recent-posts cube-sidebar" id="cube-recent-posts">
    <div class="title">
        <a>Recent Posts</a>
    </div>
    <ul class="list">
        
        
        <li>
            <!-- TODO 如果文章要显示图片，那么在front-matter上添加preview属性(url or path) -->
            
            <div class="normal">
                <p class="index first">
                    <span>1</span>
                </p>
                <p class="title">
                    <a href="/2018/04/06/sdoi2018游记/" title="四月是你の省选 - sdoi2018酱油鸡">四月是你の省选 - sdoi2018酱油鸡</a>
                </p>
            </div>
            
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>2</span>
                </p>
                <p class="title">
                    <a href="/2018/04/01/bzoj4816 [Sdoi2017]数字表格/" title="bzoj 4816 [Sdoi2017]数字表格.md">bzoj 4816 [Sdoi2017]数字表格.md</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>3</span>
                </p>
                <p class="title">
                    <a href="/2018/04/01/bzoj4817[Sdoi2017]树点涂色/" title="bzoj 4817 [Sdoi2017]树点涂色">bzoj 4817 [Sdoi2017]树点涂色</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>4</span>
                </p>
                <p class="title">
                    <a href="/2018/03/11/bzoj3994[SDOI2015]约数个数和/" title="bzoj 3994 [SDOI2015]约数个数和">bzoj 3994 [SDOI2015]约数个数和</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>5</span>
                </p>
                <p class="title">
                    <a href="/2018/03/10/总得有个说明吧QAQ/" title="&lt;置顶&gt; 罪恶的伊始">&lt;置顶&gt; 罪恶的伊始</a>
                </p>
            </div>
        </li>
        
        
    </ul>
</div>



<div class="cube-categories cube-sidebar" id="cube-categories">
    <div class="title">
        <a href="/categories">Categories</a>
    </div>
    <div class="cube-boxs">
        
        
        <div class="cube-box ">
            <a href="/categories/大ZZ的日常/">#大ZZ的日常</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/大ZZ的日常/可持久化线段树/">#可持久化线段树</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/categories/算法笔记/">#算法笔记</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/题解/">#题解</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/题解/bzoj/">#bzoj</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/题解/luogu/">#luogu</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/题解/poj/">#poj</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/题解/HDU/">#HDU</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/测试/">#测试</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/题解/loj/">#loj</a>
        </div>
        
    </div>
</div>



<div class="cube-tagcloud cube-sidebar" id="cube-tagcloud">
    <div class="title">
        <a href="/tags">Tagcloud</a>
    </div>
    <div class="cube-boxs">
        
        
        <div class="cube-box-bg ">
            <a href="/tags/测试/">#测试</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/Burnside引理与polay定理/">#Burnside引理与polay定理</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/数学/">#数学</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/题解/">#题解</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/233/">#233</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/11101001/">#11101001</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/RT/">#RT</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/排列组合/">#排列组合</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/prufer序/">#prufer序</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/tarjan/">#tarjan</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/动态规划/">#动态规划</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/欧拉函数/">#欧拉函数</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/莫比乌斯反演/">#莫比乌斯反演</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/数据结构/">#数据结构</a>
        </div>
        
        
        <div class="cube-box-bg ">
            <a href="/tags/Link-cut-tree/">#Link cut tree</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/积性函数/">#积性函数</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/说明/">#说明</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/博弈论与SG函数/">#博弈论与SG函数</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/博弈论/">#博弈论</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/tags/分块/">#分块</a>
        </div>
        
    </div>
</div>



<div class="cube-links cube-sidebar" id="cube-links">
    <div class="title">
        <a>Links</a>
    </div>
    <ul class="list">
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/GitHub.png">
            
            <a href="https://github.com/ZEROKISEKI" target="_blank">GitHub</a>
        </li>
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/Coding.png">
            
            <a href="https://coding.net/u/SORA1" target="_blank">Coding</a>
        </li>
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/SF.png">
            
            <a href="https://segmentfault.com/u/aonosora" target="_blank">SF社区</a>
        </li>
        
        <li>
            
            
            <img src="http://cube-1252774894.cosgz.myqcloud.com/links/开发者头条.png">
            
            <a href="https://toutiao.io/u/148070" target="_blank">开发者头条</a>
        </li>
        
    </ul>
</div>



<div class="cube-friend-links cube-sidebar" id="cube-friend-links">
    <div class="title">
        <a>Friend Links</a>
    </div>
    <ul class="list">
        
        <li>
            <!-- TODO change avatar.png to friend.png-->
            <img src="http://cube-1252774894.cosgz.myqcloud.com/friend_links/micblo.png">
            <a href="https://blog.micblo.com/" target="_blank">罗大佬</a>
        </li>
        
        <li>
            <!-- TODO change avatar.png to friend.png-->
            <img src="http://cube-1252774894.cosgz.myqcloud.com/friend_links/DIYgod.jpg">
            <a href="https://www.anotherhome.net/" target="_blank">DIYgod</a>
        </li>
        
        <li>
            <!-- TODO change avatar.png to friend.png-->
            <img src="/images/friend_links.jpg ">
            <a href="https://aonosora.com/" target="_blank">咪西西の部落格</a>
        </li>
        
    </ul>
</div>


        </div>
    </div>
</div>
<footer class="cube-footer">
    
© 2017 11101001

<br>
Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/ZEROKISEKI" target="_blank">AONOSORA</a>
</footer>
<!-- inject:script -->
<script src="/js/script.js"></script>
<!-- endinject -->
<div class="cube-loading out"></div>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"live2d-widget-model-wanko"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body>
</html>